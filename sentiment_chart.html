<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾è‚¡æƒ…ç»ªçœ‹æ¿ - æƒ…ç»ªåˆ†å¸ƒè¶‹åŠ¿</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }
        .chart-container {
            position: relative;
            height: 500px;
            margin-bottom: 30px;
        }
        .stats-container {
            display: flex;
            justify-content: space-around;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        .stats-description {
            text-align: center;
            margin: 20px 0;
            color: #34495e;
            font-size: 16px;
            font-weight: 500;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #2c3e50;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            border: 1px solid #dee2e6;
            min-width: 150px;
            margin: 10px;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        .stat-card h3 {
            margin: 0 0 10px 0;
            font-size: 2em;
        }
        .stat-card p {
            margin: 0;
            opacity: 0.9;
        }
        .legend {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin: 0 15px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            margin-right: 8px;
        }
        .optimistic { background-color: #27ae60; }
        .neutral { background-color: #f39c12; }
        .pessimistic { background-color: #e74c3c; }
        
        .positive-change { color: #27ae60; }
        .negative-change { color: #e74c3c; }
        .no-change { color: #7f8c8d; }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            .header h1 {
                font-size: 2em;
            }
            .chart-container {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š ç¾è‚¡æƒ…ç»ªçœ‹æ¿</h1>
            <p>è¿‡å»15ä¸ªäº¤æ˜“æ—¥æƒ…ç»ªæŒ‡æ ‡åˆ†å¸ƒè¶‹åŠ¿</p>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color optimistic"></div>
                <span>ä¹è§‚æŒ‡æ ‡</span>
            </div>
            <div class="legend-item">
                <div class="legend-color neutral"></div>
                <span>ä¸­æ€§æŒ‡æ ‡</span>
            </div>
            <div class="legend-item">
                <div class="legend-color pessimistic"></div>
                <span>æ‚²è§‚æŒ‡æ ‡</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #d3d3d3;"></div>
                <span>ç¼ºå¤±æ•°æ®</span>
            </div>
        </div>
        
        <div class="chart-container">
            <canvas id="sentimentChart"></canvas>
        </div>
        
        <div class="stats-description">
            <p>ä»¥ä¸‹æ•°æ®æ˜¾ç¤ºè¿‘5ä¸ªäº¤æ˜“æ—¥å„ç±»æƒ…ç»ªæŒ‡æ ‡çš„è¶‹åŠ¿æƒ…å†µ</p>
        </div>
        <div class="stats-container">
            <div class="stat-card">
                <h3 id="optimisticTrend">-</h3>
                <p>ä¹è§‚æŒ‡æ ‡è¶‹åŠ¿</p>
            </div>
            <div class="stat-card">
                <h3 id="neutralTrend">-</h3>
                <p>ä¸­æ€§æŒ‡æ ‡è¶‹åŠ¿</p>
            </div>
            <div class="stat-card">
                <h3 id="pessimisticTrend">-</h3>
                <p>æ‚²è§‚æŒ‡æ ‡è¶‹åŠ¿</p>
            </div>
        </div>
    </div>

    <script>
        // ä»å¤–éƒ¨JSONæ–‡ä»¶åŠ è½½æ•°æ®
        let sentimentData = null;
        
        // åŠ è½½sentiment_distribution.jsonæ–‡ä»¶
        fetch('sentiment_distribution.json')
            .then(response => response.json())
            .then(data => {
                sentimentData = data;
                initializeChart();
            })
            .catch(error => {
                console.error('Error loading sentiment data:', error);
                // å¦‚æœåŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®
                sentimentData = {
                    "overall_sentiment_distribution": [],
                    "summary": {"total_optimistic": 0, "total_neutral": 0, "total_pessimistic": 0, "total_missing": 0},
                    "date_range": {"start": "", "end": ""}
                };
                initializeChart();
            });

        // å¼‚æ­¥åŠ è½½JSONæ•°æ®çš„å‡½æ•°ï¼ˆå¯é€‰ï¼‰
        async function loadSentimentData() {
            try {
                const response = await fetch('sentiment_distribution.json');
                if (response.ok) {
                    return await response.json();
                }
            } catch (error) {
                console.log('ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®:', error.message);
            }
            return sentimentData; // å›é€€åˆ°æ¨¡æ‹Ÿæ•°æ®
        }

        // æ ¼å¼åŒ–æ—¥æœŸæ˜¾ç¤º
        function formatDate(dateString) {
            const date = new Date(dateString);
            return `${date.getMonth() + 1}/${date.getDate()}`;
        }

        // åˆå§‹åŒ–å›¾è¡¨
        async function initChart() {
            const data = await loadSentimentData();
            const distribution = data.overall_sentiment_distribution;
            
            // è®¡ç®—è¿‘5ä¸ªäº¤æ˜“æ—¥çš„è¶‹åŠ¿
            const totalDays = distribution.length;
            
            let optimisticTrend = '-', neutralTrend = '-', pessimisticTrend = '-';
            
            if (totalDays >= 5) {
                // å–æœ€è¿‘5å¤©çš„æ•°æ®
                const recent5Days = distribution.slice(-5);
                
                // è®¡ç®—æ¯ç±»æŒ‡æ ‡çš„å¹³å‡å€¼å’Œè¶‹åŠ¿
                const optimisticValues = recent5Days.map(d => d.optimistic);
                const neutralValues = recent5Days.map(d => d.neutral);
                const pessimisticValues = recent5Days.map(d => d.pessimistic);
                
                // è®¡ç®—è¶‹åŠ¿ï¼ˆæœ€åä¸¤å¤©çš„å¹³å‡å€¼ vs å‰ä¸‰å¤©çš„å¹³å‡å€¼ï¼‰
                const optimisticEarly = (optimisticValues[0] + optimisticValues[1] + optimisticValues[2]) / 3;
                const optimisticLate = (optimisticValues[3] + optimisticValues[4]) / 2;
                const optimisticTrendValue = optimisticLate - optimisticEarly;
                
                const neutralEarly = (neutralValues[0] + neutralValues[1] + neutralValues[2]) / 3;
                const neutralLate = (neutralValues[3] + neutralValues[4]) / 2;
                const neutralTrendValue = neutralLate - neutralEarly;
                
                const pessimisticEarly = (pessimisticValues[0] + pessimisticValues[1] + pessimisticValues[2]) / 3;
                const pessimisticLate = (pessimisticValues[3] + pessimisticValues[4]) / 2;
                const pessimisticTrendValue = pessimisticLate - pessimisticEarly;
                
                // æ ¼å¼åŒ–è¶‹åŠ¿æ˜¾ç¤º
                optimisticTrend = optimisticTrendValue > 0.5 ? 'â†—ï¸ ä¸Šå‡' : 
                                 optimisticTrendValue < -0.5 ? 'â†˜ï¸ ä¸‹é™' : 'â†’ å¹³ç¨³';
                neutralTrend = neutralTrendValue > 0.5 ? 'â†—ï¸ ä¸Šå‡' : 
                              neutralTrendValue < -0.5 ? 'â†˜ï¸ ä¸‹é™' : 'â†’ å¹³ç¨³';
                pessimisticTrend = pessimisticTrendValue > 0.5 ? 'â†—ï¸ ä¸Šå‡' : 
                                  pessimisticTrendValue < -0.5 ? 'â†˜ï¸ ä¸‹é™' : 'â†’ å¹³ç¨³';
                
                // è®¾ç½®é¢œè‰²æ ·å¼
                const setTrendStyle = (elementId, trendValue, trendText) => {
                    const element = document.getElementById(elementId);
                    element.textContent = trendText;
                    element.className = '';
                    if (trendValue > 0.5) {
                        element.classList.add('positive-change');
                    } else if (trendValue < -0.5) {
                        element.classList.add('negative-change');
                    } else {
                        element.classList.add('no-change');
                    }
                };
                
                setTrendStyle('optimisticTrend', optimisticTrendValue, optimisticTrend);
                setTrendStyle('neutralTrend', neutralTrendValue, neutralTrend);
                setTrendStyle('pessimisticTrend', pessimisticTrendValue, pessimisticTrend);
            } else {
                // å¦‚æœæ•°æ®ä¸è¶³5å¤©ï¼Œæ˜¾ç¤ºé»˜è®¤å€¼
                document.getElementById('optimisticTrend').textContent = 'æ•°æ®ä¸è¶³';
                document.getElementById('neutralTrend').textContent = 'æ•°æ®ä¸è¶³';
                document.getElementById('pessimisticTrend').textContent = 'æ•°æ®ä¸è¶³';
            }
            
            // å‡†å¤‡å›¾è¡¨æ•°æ®
            const labels = distribution.map(item => formatDate(item.date));
            const optimisticData = distribution.map(item => item.optimistic);
            const neutralData = distribution.map(item => item.neutral);
            const pessimisticData = distribution.map(item => item.pessimistic);
            const missingData = distribution.map(item => item.missing || 0);
            
            // åˆ›å»ºå›¾è¡¨
            const ctx = document.getElementById('sentimentChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'ä¹è§‚æŒ‡æ ‡',
                            data: optimisticData,
                            backgroundColor: '#27ae60',
                            borderColor: '#229954',
                            borderWidth: 1
                        },
                        {
                            label: 'ä¸­æ€§æŒ‡æ ‡',
                            data: neutralData,
                            backgroundColor: '#f39c12',
                            borderColor: '#e67e22',
                            borderWidth: 1
                        },
                        {
                            label: 'æ‚²è§‚æŒ‡æ ‡',
                            data: pessimisticData,
                            backgroundColor: '#e74c3c',
                            borderColor: '#c0392b',
                            borderWidth: 1
                        },
                        {
                            label: 'ç¼ºå¤±æ•°æ®',
                            data: missingData,
                            backgroundColor: '#d3d3d3',
                            borderColor: '#bbb',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'ç¾è‚¡æƒ…ç»ªæŒ‡æ ‡åˆ†å¸ƒè¶‹åŠ¿',
                            font: {
                                size: 18,
                                weight: 'bold'
                            },
                            padding: 20
                        },
                        legend: {
                            display: false // ä½¿ç”¨è‡ªå®šä¹‰å›¾ä¾‹
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                title: function(context) {
                                    const index = context[0].dataIndex;
                                    return distribution[index].date;
                                },
                                footer: function(context) {
                                    const index = context[0].dataIndex;
                                    return `æ€»è®¡: ${distribution[index].total} ä¸ªæŒ‡æ ‡`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            title: {
                                display: true,
                                text: 'äº¤æ˜“æ—¥æœŸ',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'æŒ‡æ ‡æ•°é‡',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            ticks: {
                                stepSize: 1
                            }
                        }
                    },
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeInOutQuart'
                    }
                }
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–å›¾è¡¨
        document.addEventListener('DOMContentLoaded', initChart);
    </script>
</body>
</html>